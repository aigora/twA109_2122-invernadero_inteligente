#include "DHT.h"
#define SensorPin A0
#define LUZ A1
DHT dht(2, DHT11);

float t;
float dospinchos;
float valorluz;
int pin=9;

void setup()
{
  // Tareas de configuraciÃ³n 

  Serial.begin(9600);
  // PREPARAR LA LIBRERIA PARA COMUNICARSE CON EL SENSOR//
  dht.begin();

  pinMode(pin,OUTPUT);
}

void loop()
{
    
      if (Serial.available() > 0)  // Si hay mensajes procedentes del PC  
    activarbomba();
    datos();
    hum();
    tem();
    luz();
    activarled();
    activarvent();
    
  float t = dht.readTemperature();
  float valorluz=0;
  valorluz = analogRead(LUZ);
  float dospinchos = analogRead(SensorPin);;//Valor del sensor// 
  Serial.println(dospinchos);  
  
}
  
   // Resto de acciones 
void hum(void){
  String cadena = Serial.readStringUntil('\n'); // Lee mensaje
 if (cadena.equals("GET_HUM")) // Requisito 4
 {
  Serial.print("Humedad del suelo: ");
  Serial.println(dospinchos);
  Serial.print(" % ");
 }
}
void tem(void){
  String cadena = Serial.readStringUntil('\n'); // Lee mensaje
 if (cadena.equals("GET_TEMP")) // Requisito 4
 {
  Serial.print("Temperatura: ");
  Serial.print(t);
  Serial.println(" *C");
  }
}
void luz(void){
  String cadena = Serial.readStringUntil('\n'); // Lee mensaje
 if (cadena.equals("GET_LUZ")) // Requisito 4
 {
  Serial.print("Valor luz: ");
  Serial.println(valorluz);
  }
}

void datos(void)
{
 String cadena = Serial.readStringUntil('\n'); // Lee mensaje
 if (cadena.equals("DATOS")) // Requisito 4
 {
  Serial.print("Humedad del suelo: ");
  Serial.println(dospinchos);
  Serial.print(" % ");
  Serial.print("Temperatura: ");
  Serial.print(t);
  Serial.println(" *C");// Requisito 6
  Serial.print("Valor luz: ");
  Serial.println(valorluz);
 }
}

 void activarbomba(void)//FUNCION PARA ACTIVAR LA BOMBA DE AGUA 10 SEGUNDOS
 {
 String cadena = Serial.readStringUntil('\n');//Leer valor hasta recibir \n
 if (cadena.equals("BOMBA")) //SI LA CADENA RECIBIDA DICE "BOMBA"
  {
  digitalWrite(pin, HIGH); //PONER EL PIN EN HIGH
  delay (10000);//ESPERAR 10 SEGUNDOS
  digitalWrite(pin,LOW);
  delay(10000);  
    }
  }
   void activarled(void)//FUNCION PARA ACTIVAR LA BOMBA DE AGUA 10 SEGUNDOS
 {
 String cadena = Serial.readStringUntil('\n');//Leer valor hasta recibir \n
 if (cadena.equals("LED")) //SI LA CADENA RECIBIDA DICE "LED"
  {
  digitalWrite(pin, HIGH); //PONER EL PIN EN HIGH
  delay (10000);//ESPERAR 10 SEGUNDOS
  digitalWrite(pin,LOW);
  delay(10000);  
    }
  }
  void activarvent(void){
     String cadena = Serial.readStringUntil('\n');//Leer valor hasta recibir \n
 if (cadena.equals("VENT")) //SI LA CADENA RECIBIDA DICE "VENT"
  {
  digitalWrite(pin, HIGH); //PONER EL PIN EN HIGH
  delay (10000);//ESPERAR 10 SEGUNDOS
  digitalWrite(pin,LOW);
  delay(10000);  
    }
  }
