#include <DHT.h>

#define HUMSUELOPIN A0
#define LUZPIN A1
#define DHTPIN 2
#define DHTTYPE DHT11

DHT dht(DHTPIN, DHTTYPE);

float t;
float dospinchos;
float valorluz;
int LEDPIN=9,VENTPIN=10,BOMBAPIN=11;
String cad;


void setup(){ 
  Serial.begin(9600);
  dht.begin();

  pinMode(LEDPIN,OUTPUT); // pin luz
  pinMode(VENTPIN,OUTPUT); // pin ventilador
  pinMode(BOMBAPIN,OUTPUT); // pin bomba
}

void loop(){
  if (Serial.available() > 0){ // Si hay mensajes procedentes del PC  
    cad = Serial.readStringUntil('\n');
    if (cad.equals("DATOS")) datos();
    else if (cad.equals("GET_HUM")) hum();
    else if (cad.equals("GET_TEMP")) tem();
    else if (cad.equals("GET_LUZ")) luz();
    else if (cad.equals("LED0") || cad.equals("LED1")) activarLed();
    else if (cad.equals("VENT0") || cad.equals("VENT1")) activarVent();
    else if (cad.equals("BOMBA0") || cad.equals("BOMBA1")) activarBomba();
  }
}
  
   // Resto de acciones 
void hum(void){
  dospinchos = analogRead(HUMSUELOPIN);
  Serial.print("Humedad del suelo: ");
  Serial.print(dospinchos);
  Serial.println(" %");
}
void tem(void){
  t = dht.readTemperature();
  Serial.print("Temperatura: ");
  Serial.print(t);
  Serial.println(" ºC");
}
void luz(void){
  valorluz = analogRead(LUZPIN);
  Serial.print("Valor luz: ");
  Serial.println(valorluz);
}

void datos(void){
  dospinchos = analogRead(HUMSUELOPIN);
  Serial.print("Humedad del suelo: ");
  Serial.print(dospinchos);
  Serial.println(" % ");

  t = dht.readTemperature();
  Serial.print("Temperatura: ");
  Serial.print(t);
  Serial.println(" ºC");

  valorluz = analogRead(LUZPIN);
  Serial.print("Valor luz: ");
  Serial.println(valorluz);
}

void activarBomba(void){
  if (cad.equals("BOMBA1")){
    digitalWrite(BOMBAPIN, HIGH); //PONER EL PIN EN HIGH
  }
  if (cad.equals("BOMBA0")){
    digitalWrite(BOMBAPIN,LOW);
  }
}

void activarLed(void){
  if (cad.equals("LED1")){
    digitalWrite(LEDPIN, HIGH); //PONER EL PIN EN HIGH
  }
  if(cad.equals("LED0")){
    digitalWrite(LEDPIN,LOW);
  }
}

void activarVent(void){
  if (cad.equals("VENT1")){
    digitalWrite(VENTPIN, HIGH); //PONER EL PIN EN HIGH
  }
  if(cad.equals("VENT0")){
    digitalWrite(VENTPIN,LOW);
  }
}
