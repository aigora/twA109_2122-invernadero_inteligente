#include "DHT.h"
#define SensorPin A0
#define LUZ A1
DHT dht(2, DHT11);

float t;
float dospinchos;
float valorluz;
int pinl=9,pinv=10,pinb=11;


void setup()
{
  // Tareas de configuraciÃ³n 

  Serial.begin(9600);
  // PREPARAR LA LIBRERIA PARA COMUNICARSE CON EL SENSOR//
  dht.begin();

  pinMode(pinl,OUTPUT); // pin luz
  pinMode(pinv,OUTPUT); // pin ventilador
  pinMode(pinb,OUTPUT); // pin bomba
  
}

void loop()
{
    
      if (Serial.available() > 0)  // Si hay mensajes procedentes del PC  
    activarbomba();
    datos();
    hum();
    tem();
    luz();
    activarled();
    activarvent();
    
  float t = dht.readTemperature();
  float valorluz=0;
  valorluz = analogRead(LUZ);
  float dospinchos = analogRead(SensorPin);;//Valor del sensor// 
  Serial.println(dospinchos);  
  
}
  
   // Resto de acciones 
void hum(void){
  String cadena = Serial.readStringUntil('\n'); // Lee mensaje
 if (cadena.equals("GET_HUM")) // Requisito 4
 {
  Serial.print("Humedad del suelo: ");
  Serial.println(dospinchos);
  Serial.print(" % ");
 }
}
void tem(void){
  String cadena = Serial.readStringUntil('\n'); // Lee mensaje
 if (cadena.equals("GET_TEMP")) // Requisito 4
 {
  Serial.print("Temperatura: ");
  Serial.print(t);
  Serial.println(" *C");
  }
}
void luz(void){
  String cadena = Serial.readStringUntil('\n'); // Lee mensaje
 if (cadena.equals("GET_LUZ")) // Requisito 4
 {
  Serial.print("Valor luz: ");
  Serial.println(valorluz);
  }
}

void datos(void)
{
 String cadena = Serial.readStringUntil('\n'); // Lee mensaje
 if (cadena.equals("DATOS")) // Requisito 4
 {
  Serial.print("Humedad del suelo: ");
  Serial.println(dospinchos);
  Serial.print(" % ");
  Serial.print("Temperatura: ");
  Serial.print(t);
  Serial.println(" *C");// Requisito 6
  Serial.print("Valor luz: ");
  Serial.println(valorluz);
 }
}

 void activarbomba(void)//FUNCION PARA ACTIVAR LA BOMBA DE AGUA 10 SEGUNDOS
 {
 String cadena = Serial.readStringUntil('\n');//Leer valor hasta recibir \n
 if (cadena.equals("BOMBA1")) //SI LA CADENA RECIBIDA "DICE" BOMBA
  {
  digitalWrite(pinb, HIGH); //PONER EL PIN EN HIGH
    }
     if (cadena.equals("BOMBA0")) //SI LA CADENA RECIBIDA "DICE" BOMBA
  {
  digitalWrite(pinb,LOW);
    }
  }
   void activarled(void)//FUNCION PARA ACTIVAR LA BOMBA DE AGUA 10 SEGUNDOS
 {
 String cadena = Serial.readStringUntil('\n');//Leer valor hasta recibir \n
 if (cadena.equals("LED1")) //SI LA CADENA RECIBIDA "DICE" BOMBA
  {
  digitalWrite(pinl, HIGH); //PONER EL PIN EN HIGH
  }
  if(cadena.equals("LED0")){
  digitalWrite(pinl,LOW);
    }
  }
  void activarvent(void){
     String cadena = Serial.readStringUntil('\n');//Leer valor hasta recibir \n
 if (cadena.equals("VENT1")) //SI LA CADENA RECIBIDA "DICE" BOMBA
  {
  digitalWrite(pinv, HIGH); //PONER EL PIN EN HIGH
  }
  if(cadena.equals("VENT0")){
  digitalWrite(pinv,LOW);
    }
  }
